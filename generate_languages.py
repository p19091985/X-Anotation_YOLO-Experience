import xml.etree.ElementTree as ET
import xml.dom.minidom
import time
import sys
try:
    from deep_translator import GoogleTranslator
except ImportError:
    print("ERRO CR√çTICO: Biblioteca 'deep-translator' n√£o encontrada.")
    print('Execute: pip install deep-translator')
    sys.exit(1)
PT_STRINGS = {'NEW_PROJECT': '‚ú® Novo', 'OPEN_PROJECT': 'üìÇ Abrir', 'GRID_VIEW': 'üîç Grade', 'ANALYZER': 'üìä An√°lise', 'SPLIT': '‚öñÔ∏è Divis√£o', 'ABOUT': '‚ÑπÔ∏è Sobre', 'DRAW_MODE': 'Ativar Modo Desenho (D)', 'ANNOTATION_TYPE': 'Tipo de Anota√ß√£o', 'BOX_MODE': '‚¨õ Box (Detec√ß√£o)', 'POLY_MODE': 'üî∑ Pol√≠gono (Segmenta√ß√£o)', 'POLY_HINT': 'Dica Poly: Bot√£o Dir. fecha forma', 'CLASS_LABEL': 'Classe:', 'SET_BTN': 'Definir', 'MANAGE_CLASSES': '‚öôÔ∏è Gerenciar Classes', 'PREV_IMG': '‚Üê Anterior', 'NEXT_IMG': 'Pr√≥ximo ‚Üí', 'NO_PROJECT': 'Nenhum projeto aberto', 'IMAGES_FRAME': 'Imagens', 'ANNOTATIONS_FRAME': 'Anota√ß√µes (Objetos)', 'NOTES': 'Notas:', 'TITLE_NEW_PROJECT': 'Novo Projeto YOLO - Configura√ß√£o Avan√ßada', 'GRP_PROJECT_DEF': ' 1. Defini√ß√µes do Projeto ', 'LBL_PROJECT_NAME': 'Nome do Projeto:', 'LBL_LOCATION': 'Localiza√ß√£o:', 'BTN_BROWSE': 'üìÇ Escolher Pasta', 'GRP_CLASS_STRUCT': ' 2. Estrutura de Classes (Ontologia) ', 'BTN_ADD': '‚ûï Adicionar', 'BTN_EDIT': '‚úèÔ∏è Editar', 'BTN_REMOVE': 'üóëÔ∏è Remover', 'BTN_CLEAR_ALL': 'üßπ Limpar Tudo', 'COL_ID': 'ID', 'COL_CLASS_NAME': 'Nome da Classe', 'BTN_CANCEL': 'Cancelar', 'BTN_CREATE_YOLO': 'üöÄ CRIAR ESTRUTURA YOLO', 'DIALOG_DIR_TITLE': 'Selecione o diret√≥rio pai do projeto', 'DIALOG_NEW_CLASS_TITLE': 'Nova Classe', 'DIALOG_NEW_CLASS_MSG': 'Digite o nome da classe:', 'MSG_DUPLICATE_TITLE': 'Duplicada', 'MSG_DUPLICATE_BODY': "A classe '{}' j√° existe.", 'DIALOG_EDIT_CLASS_TITLE': 'Editar Classe', 'DIALOG_EDIT_CLASS_MSG': 'Novo nome:', 'DIALOG_CONFIRM_TITLE': 'Confirmar', 'MSG_REMOVE_CLASS_BODY': "Remover a classe '{}'?", 'DIALOG_CLEAR_TITLE': 'Limpar', 'MSG_CLEAR_ALL_BODY': 'Remover TODAS as classes?', 'MSG_WARN_TITLE': 'Aten√ß√£o', 'MSG_REQ_NAME': 'O projeto precisa de um nome.', 'MSG_REQ_PATH': 'Selecione a pasta onde o projeto ser√° salvo.', 'MSG_REQ_CLASS': 'O dataset precisa de pelo menos uma classe.', 'MSG_ERR_EXISTS_TITLE': 'Erro', 'MSG_ERR_EXISTS_BODY': "A pasta '{}' j√° existe neste local.\nEscolha outro nome ou local.", 'MSG_SUCCESS_TITLE': 'Sucesso', 'MSG_SUCCESS_BODY': "Projeto '{}' criado com sucesso!\n\nEstrutura (Train/Val/Test) gerada.", 'MSG_ERR_CRITICAL_TITLE': 'Erro Cr√≠tico', 'MSG_ERR_CREATE_BODY': 'Falha ao criar estrutura de arquivos:\n{}', 'TITLE_SPLIT_WIZARD': 'Assistente de Divis√£o (Train / Val)', 'LBL_DISTRIBUTION': 'Distribui√ß√£o Train / Val', 'LBL_TRAIN': 'TRAIN', 'LBL_VAL': 'VALIDATION', 'CHK_SHUFFLE': 'Embaralhar arquivos (Shuffle)', 'BTN_APPLY_SPLIT': 'APLICAR DIVIS√ÉO', 'TITLE_CLASS_MANAGER': 'Gerenciar Classes', 'GRP_CURRENT_CLASSES': 'Classes Atuais', 'BTN_RENAME': '‚úèÔ∏è Renomear', 'BTN_DELETE': 'üóëÔ∏è Excluir', 'BTN_SAVE_CLOSE': 'üíæ Salvar Altera√ß√µes e Fechar', 'DIALOG_EDIT_TITLE': 'Editar', 'DIALOG_EDIT_MSG': 'Novo nome:', 'TITLE_GRID_VIEWER': 'Matrix Viewer Pro (Segmentation)', 'MSG_INIT_GRID': 'Iniciando Grid Viewer v8.0 - Polygon Support', 'LBL_GRID_HEADER': 'VISUALIZA√á√ÉO EM GRADE', 'LBL_ITEMS_PER_PAGE': 'Itens por p√°g:', 'LBL_PAGE_INFO': 'P√°gina {} de {}', 'LBL_RENDERING': 'Renderizando...', 'LBL_NAV_HINT': 'Navegue com as Setas do Teclado', 'BTN_PREV_PAGE': '‚óÑ Anterior', 'BTN_NEXT_PAGE': 'Pr√≥ximo ‚ñ∫', 'MSG_ANNOTATIONS_COUNT': '‚úÖ {} Anota√ß√µes', 'MSG_NO_ANNOTATIONS': '‚ö† 0 Anota√ß√µes', 'TITLE_ANALYZER': 'An√°lise Forense do Dataset (Full)', 'LBL_DETAILED_TECH': 'Detalhamento T√©cnico:', 'LBL_STATUS_INIT': 'Inicializando varredura...', 'TAB_REPORT': 'üìë Relat√≥rio T√©cnico', 'TAB_DASHBOARD': 'üìä Classes & Resumo', 'TAB_LOG': 'üìà Distribui√ß√£o (Colunas)', 'TAB_SPLIT': 'üìä Distribui√ß√£o do Split', 'TAB_INTEGRITY': '‚ö†Ô∏è Integridade & √ìrf√£os', 'GRP_CLASS_SUMMARY': 'Resumo de Classes', 'COL_QTY': 'Qtd', 'COL_PCT': 'Pct', 'COL_BAR': 'Barra', 'LBL_STD_VIEW': 'Visualiza√ß√£o Padr√£o', 'BTN_SAVE_IMG': 'üì∑ Salvar Imagem', 'CHART_IMG_BY_SPLIT': 'Imagens por Split', 'CHART_OBJ_BY_SPLIT': 'Objetos (Anota√ß√µes) por Split', 'CHART_DIST_LINEAR': 'Distribui√ß√£o (Linear)', 'CHART_DIST_LOG': 'Distribui√ß√£o de Anota√ß√µes (Colunas Normais)', 'AXIS_QTY': 'Quantidade', 'AXIS_ANNOTATIONS_NUM': 'N¬∫ de Anota√ß√µes', 'AXIS_CLASS': 'Classe', 'REPORT_TITLE': 'RELAT√ìRIO DE ANALISE FORENSE - DATASET YOLO', 'REPORT_GENERATED_AT': 'Gerado em: {}', 'REPORT_BASE_DIR': 'Diret√≥rio Base: {}', 'REPORT_SUMMARY': '[RESUMO ESTAT√çSTICO]', 'REPORT_TOTAL_IMG': 'Total Imagens: {}', 'REPORT_TOTAL_OBJ': 'Total Objetos: {}', 'REPORT_TYPES': 'Tipos de Anota√ß√£o: BOXES={} | POL√çGONOS={}', 'REPORT_AVG': 'M√©dia Objetos/Img: {:.2f}', 'REPORT_DIST_SPLIT': '\n[DISTRIBUI√á√ÉO SPLIT]', 'REPORT_INTEGRITY': '\n[PROBLEMAS DE INTEGRIDADE]', 'REPORT_NO_LBL': '  Imagens sem anota√ß√£o: {}', 'REPORT_NO_IMG': '  Anota√ß√µes sem imagem: {}', 'REPORT_FILE_DETAILS': '[DETALHAMENTO ARQUIVO A ARQUIVO]', 'REPORT_DIR_STRUCT': '[ESTRUTURA DE DIRET√ìRIOS]', 'LBL_LOG_HEADER': 'An√°lise de Distribui√ß√£o (Colunas Normais)', 'LBL_SPLIT_HEADER': 'Divis√£o do Dataset (Train / Val / Test)', 'BTN_SAVE_CHARTS': 'üì∑ Salvar Gr√°ficos', 'GRP_IMG_SPLIT': 'Imagens por Split', 'GRP_OBJ_SPLIT': 'Anota√ß√µes (Objetos) por Split', 'GRP_IMG_NO_LBL': 'Imagens sem Anota√ß√µes (ou vazias)', 'GRP_LBL_NO_IMG': 'Anota√ß√µes sem Imagens (√ìrf√£s)', 'COL_FILENAME': 'Nome do Arquivo', 'COL_FOLDER': 'Pasta', 'COL_FILENAME_TXT': 'Nome do Arquivo (.txt)', 'BTN_COPY_ALL': 'üìã Copiar Tudo', 'BTN_EXPORT': 'üíæ Exportar CSV/TXT', 'LBL_REPORT_HINT': ' (A sa√≠da inclui √°rvore de diret√≥rios ao final)', 'MSG_SCANNING': 'Varrendo metadados (isso pode demorar)...', 'MSG_GENERATING': 'Gerando gr√°ficos e relat√≥rios...', 'MSG_ANALYSIS_COMPLETE': 'An√°lise Completa.', 'TITLE_ERR_ANALYSIS': 'Erro de An√°lise', 'TITLE_ERR_RENDER': 'Erro de Renderiza√ß√£o', 'MSG_CHARTS_SAVED': 'Gr√°ficos salvos.', 'MSG_CHART_NOT_READY': 'O gr√°fico ainda n√£o foi gerado.', 'TITLE_SAVE_CHART': 'Salvar Gr√°fico ({})', 'MSG_CHART_SAVED_AT': 'Gr√°fico salvo em:\n{}', 'TITLE_CLIPBOARD': 'Clipboard', 'MSG_COPIED': 'Relat√≥rio copiado.', 'TITLE_SAVE_REPORT': 'Salvar Relat√≥rio', 'TITLE_SAVED': 'Salvo', 'MSG_REPORT_SAVED_AT': 'Relat√≥rio salvo em:\n{}', 'COL_FILE': 'ARQUIVO', 'COL_RES': 'RES', 'COL_ANNS': 'ANNS', 'COL_CLASSES': 'CLASSES', 'TITLE_ABOUT': 'Sobre', 'LBL_AUTHOR': 'Autor:', 'LBL_EMAIL': 'Email:', 'LBL_VERSION': 'Vers√£o:', 'LBL_DESC': 'Descri√ß√£o:', 'MSG_DESC_TEXT': 'Ferramenta avan√ßada para anota√ß√£o e segmenta√ß√£o de imagens para treinamento de modelos YOLO.\nDesenvolvida para facilitar a cria√ß√£o, edi√ß√£o e an√°lise de datasets de vis√£o computacional.', 'BTN_CLOSE': 'Fechar'}
EN_STRINGS = {'NEW_PROJECT': '‚ú® New', 'OPEN_PROJECT': 'üìÇ Open', 'GRID_VIEW': 'üîç Grid', 'ANALYZER': 'üìä Stats', 'SPLIT': '‚öñÔ∏è Split', 'ABOUT': '‚ÑπÔ∏è About', 'DRAW_MODE': 'Enable Draw Mode (D)', 'ANNOTATION_TYPE': 'Annotation Type', 'BOX_MODE': '‚¨õ Box (Detection)', 'POLY_MODE': 'üî∑ Polygon (Segmentation)', 'POLY_HINT': 'Poly Hint: Right Click closes shape', 'CLASS_LABEL': 'Class:', 'SET_BTN': 'Set', 'MANAGE_CLASSES': '‚öôÔ∏è Manage Classes', 'PREV_IMG': '‚Üê Previous', 'NEXT_IMG': 'Next ‚Üí', 'NO_PROJECT': 'No project open', 'IMAGES_FRAME': 'Images', 'ANNOTATIONS_FRAME': 'Annotations (Objects)', 'TOOLS_FRAME': 'Tools & Mode', 'TITLE_NEW_PROJECT': 'New YOLO Project - Advanced Setup', 'GRP_PROJECT_DEF': ' 1. Project Definitions ', 'LBL_PROJECT_NAME': 'Project Name:', 'LBL_LOCATION': 'Location:', 'BTN_BROWSE': 'üìÇ Browse Folder', 'GRP_CLASS_STRUCT': ' 2. Class Structure (Ontology) ', 'BTN_ADD': '‚ûï Add', 'BTN_EDIT': '‚úèÔ∏è Edit', 'BTN_REMOVE': 'üóëÔ∏è Remove', 'BTN_CLEAR_ALL': 'üßπ Clear All', 'COL_ID': 'ID', 'COL_CLASS_NAME': 'Class Name', 'BTN_CANCEL': 'Cancel', 'BTN_CREATE_YOLO': 'üöÄ CREATE YOLO STRUCTURE', 'DIALOG_DIR_TITLE': 'Select Project Parent Directory', 'DIALOG_NEW_CLASS_TITLE': 'New Class', 'DIALOG_NEW_CLASS_MSG': 'Enter class name:', 'MSG_DUPLICATE_TITLE': 'Duplicate', 'MSG_DUPLICATE_BODY': "Class '{}' already exists.", 'DIALOG_EDIT_CLASS_TITLE': 'Edit Class', 'DIALOG_EDIT_CLASS_MSG': 'New name:', 'DIALOG_CONFIRM_TITLE': 'Confirm', 'MSG_REMOVE_CLASS_BODY': "Remove class '{}'?", 'DIALOG_CLEAR_TITLE': 'Clear', 'MSG_CLEAR_ALL_BODY': 'Remove ALL classes?', 'MSG_WARN_TITLE': 'Warning', 'MSG_REQ_NAME': 'Project name is required.', 'MSG_REQ_PATH': 'Select the destination folder.', 'MSG_REQ_CLASS': 'At least one class is required.', 'MSG_ERR_EXISTS_TITLE': 'Error', 'MSG_ERR_EXISTS_BODY': "Folder '{}' already exists here.\nChoose another name or location.", 'MSG_SUCCESS_TITLE': 'Success', 'MSG_SUCCESS_BODY': "Project '{}' created successfully!\n\nStructure (Train/Val/Test) generated.", 'MSG_ERR_CRITICAL_TITLE': 'Critical Error', 'MSG_ERR_CREATE_BODY': 'Failed to create file structure:\n{}', 'TITLE_SPLIT_WIZARD': 'Split Wizard (Train / Val)', 'LBL_DISTRIBUTION': 'Distribution Train / Val', 'LBL_TRAIN': 'TRAIN', 'LBL_VAL': 'VALIDATION', 'CHK_SHUFFLE': 'Shuffle files', 'BTN_APPLY_SPLIT': 'APPLY SPLIT', 'TITLE_CLASS_MANAGER': 'Manage Classes', 'GRP_CURRENT_CLASSES': 'Current Classes', 'BTN_RENAME': '‚úèÔ∏è Rename', 'BTN_DELETE': 'üóëÔ∏è Delete', 'BTN_SAVE_CLOSE': 'üíæ Save Changes and Close', 'DIALOG_EDIT_TITLE': 'Edit', 'DIALOG_EDIT_MSG': 'New name:', 'TITLE_GRID_VIEWER': 'Matrix Viewer Pro (Segmentation)', 'MSG_INIT_GRID': 'Starting Grid Viewer v8.0 - Polygon Support', 'LBL_GRID_HEADER': 'GRID VIEW VISUALIZATION', 'LBL_ITEMS_PER_PAGE': 'Items per page:', 'LBL_PAGE_INFO': 'Page {} of {}', 'LBL_RENDERING': 'Rendering...', 'LBL_NAV_HINT': 'navigate with Keyboard Arrows', 'BTN_PREV_PAGE': '‚óÑ Previous', 'BTN_NEXT_PAGE': 'Next ‚ñ∫', 'MSG_ANNOTATIONS_COUNT': '‚úÖ {} Annotations', 'MSG_NO_ANNOTATIONS': '‚ö† 0 Annotations', 'TITLE_ANALYZER': 'Dataset Forensic Analysis (Full)', 'LBL_DETAILED_TECH': 'Technical Detail:', 'LBL_STATUS_INIT': 'Initializing scan...', 'TAB_REPORT': 'üìë Technical Report', 'TAB_DASHBOARD': 'üìä Classes & Summary', 'TAB_LOG': 'üìà Distribution (Columns)', 'TAB_SPLIT': 'üìä Split Distribution', 'TAB_INTEGRITY': '‚ö†Ô∏è Integrity & Orphans', 'GRP_CLASS_SUMMARY': 'Class Summary', 'COL_QTY': 'Qty', 'COL_PCT': 'Pct', 'COL_BAR': 'Bar', 'LBL_STD_VIEW': 'Standard View', 'BTN_SAVE_IMG': 'üì∑ Save Image', 'CHART_IMG_BY_SPLIT': 'Images by Split', 'CHART_OBJ_BY_SPLIT': 'Objects (Annotations) by Split', 'CHART_DIST_LINEAR': 'Distribution (Linear)', 'CHART_DIST_LOG': 'Annotation Distribution (Standard Columns)', 'AXIS_QTY': 'Quantity', 'AXIS_ANNOTATIONS_NUM': '# of Annotations', 'AXIS_CLASS': 'Class', 'REPORT_TITLE': 'DATASET FORENSIC ANALYSIS REPORT - YOLO', 'REPORT_GENERATED_AT': 'Generated at: {}', 'REPORT_BASE_DIR': 'Base Directory: {}', 'REPORT_SUMMARY': '[STATISTICAL SUMMARY]', 'REPORT_TOTAL_IMG': 'Total Images: {}', 'REPORT_TOTAL_OBJ': 'Total Objects: {}', 'REPORT_TYPES': 'Annotation Types: BOXES={} | POLYGONS={}', 'REPORT_AVG': 'Avg Objects/Img: {:.2f}', 'REPORT_DIST_SPLIT': '\n[SPLIT DISTRIBUTION]', 'REPORT_INTEGRITY': '\n[INTEGRITY ISSUES]', 'REPORT_NO_LBL': '  Images without annotation: {}', 'REPORT_NO_IMG': '  Annotations without image: {}', 'REPORT_FILE_DETAILS': '[FILE DETAIL]', 'REPORT_DIR_STRUCT': '[DIRECTORY STRUCTURE]', 'LBL_LOG_HEADER': 'Distribution Analysis (Standard Columns)', 'LBL_SPLIT_HEADER': 'Dataset Split (Train / Val / Test)', 'BTN_SAVE_CHARTS': 'üì∑ Save Charts', 'GRP_IMG_SPLIT': 'Images by Split', 'GRP_OBJ_SPLIT': 'Annotations (Objects) by Split', 'GRP_IMG_NO_LBL': 'Images without Annotations (or empty)', 'GRP_LBL_NO_IMG': 'Annotations without Images (Orphans)', 'COL_FILENAME': 'Filename', 'COL_FOLDER': 'Folder', 'COL_FILENAME_TXT': 'Filename (.txt)', 'BTN_COPY_ALL': 'üìã Copy All', 'BTN_EXPORT': 'üíæ Export CSV/TXT', 'LBL_REPORT_HINT': ' (Output includes full directory tree at the end)', 'MSG_SCANNING': 'Scanning metadata (this may take a while)...', 'MSG_GENERATING': 'Generating charts and reports...', 'MSG_ANALYSIS_COMPLETE': 'Analysis Complete.', 'TITLE_ERR_ANALYSIS': 'Analysis Error', 'TITLE_ERR_RENDER': 'Render Error', 'MSG_CHARTS_SAVED': 'Charts saved.', 'MSG_CHART_NOT_READY': 'Chart not generated yet.', 'TITLE_SAVE_CHART': 'Save Chart ({})', 'MSG_CHART_SAVED_AT': 'Chart saved at:\n{}', 'TITLE_CLIPBOARD': 'Clipboard', 'MSG_COPIED': 'Report copied.', 'TITLE_SAVE_REPORT': 'Save Report', 'TITLE_SAVED': 'Saved', 'MSG_REPORT_SAVED_AT': 'Report saved at:\n{}', 'COL_FILE': 'FILE', 'COL_RES': 'RES', 'COL_ANNS': 'ANNS', 'COL_CLASSES': 'CLASSES', 'TITLE_ABOUT': 'About X-Annotation', 'LBL_AUTHOR': 'Author:', 'LBL_EMAIL': 'Email:', 'LBL_VERSION': 'Version:', 'LBL_DESC': 'Description:', 'MSG_DESC_TEXT': 'Advanced tool for image annotation and segmentation for YOLO model training.\nDesigned to facilitate the creation, editing, and analysis of computer vision datasets.', 'BTN_CLOSE': 'Close'}
LANGUAGES = [('pt_BR', 'Portugu√™s (Brasil)'), ('en_US', 'English'), ('es_ES', 'Espa√±ol'), ('zh_CN', 'Chinese (Mandarin)'), ('hi_IN', 'Hindi'), ('ar_SA', 'Arabic'), ('bn_BD', 'Bengali'), ('ru_RU', 'Russian'), ('ja_JP', 'Japanese'), ('de_DE', 'German'), ('fr_FR', 'French'), ('jv_ID', 'Javanese'), ('ko_KR', 'Korean'), ('te_IN', 'Telugu'), ('mr_IN', 'Marathi'), ('tr_TR', 'Turkish'), ('ta_IN', 'Tamil'), ('vi_VN', 'Vietnamese'), ('ur_PK', 'Urdu'), ('it_IT', 'Italian'), ('pl_PL', 'Polish'), ('uk_UA', 'Ukrainian'), ('nl_NL', 'Dutch'), ('id_ID', 'Indonesian'), ('fa_IR', 'Persian'), ('gu_IN', 'Gujarati'), ('kn_IN', 'Kannada'), ('ml_IN', 'Malayalam'), ('th_TH', 'Thai'), ('am_ET', 'Amharic'), ('or_IN', 'Odia'), ('my_MM', 'Burmese'), ('ha_NG', 'Hausa'), ('yo_NG', 'Yoruba'), ('ig_NG', 'Igbo'), ('zu_ZA', 'Zulu'), ('ro_RO', 'Romanian'), ('az_AZ', 'Azerbaijani'), ('sv_SE', 'Swedish'), ('el_GR', 'Greek'), ('cs_CZ', 'Czech'), ('hu_HU', 'Hungarian'), ('be_BY', 'Belarusian'), ('bg_BG', 'Bulgarian'), ('da_DK', 'Danish'), ('fi_FI', 'Finnish'), ('sk_SK', 'Slovak'), ('no_NO', 'Norwegian'), ('he_IL', 'Hebrew'), ('lt_LT', 'Lithuanian'), ('sl_SI', 'Slovenian'), ('et_EE', 'Estonian'), ('lv_LV', 'Latvian'), ('sr_RS', 'Serbian'), ('hr_HR', 'Croatian'), ('ms_MY', 'Malay'), ('fil_PH', 'Filipino'), ('sw_KE', 'Swahili'), ('km_KH', 'Khmer'), ('lo_LA', 'Lao'), ('ne_NP', 'Nepali'), ('si_LK', 'Sinhala'), ('mn_MN', 'Mongolian'), ('ka_GE', 'Georgian'), ('hy_AM', 'Armenian'), ('kk_KZ', 'Kazakh'), ('uz_UZ', 'Uzbek'), ('ky_KG', 'Kyrgyz'), ('tg_TJ', 'Tajik'), ('tk_TM', 'Turkmen'), ('is_IS', 'Icelandic'), ('sq_AL', 'Albanian'), ('mk_MK', 'Macedonian'), ('bs_BA', 'Bosnian'), ('af_ZA', 'Afrikaans'), ('xh_ZA', 'Xhosa'), ('so_SO', 'Somali'), ('rw_RW', 'Kinyarwanda'), ('ug_CN', 'Uyghur'), ('ku_TR', 'Kurdish'), ('ps_AF', 'Pashto'), ('pa_IN', 'Punjabi'), ('sd_PK', 'Sindhi'), ('as_IN', 'Assamese'), ('mai_IN', 'Maithili'), ('bho_IN', 'Bhojpuri'), ('dz_BT', 'Dzongkha'), ('ti_ET', 'Tigrinya'), ('om_ET', 'Oromo'), ('st_ZA', 'Sotho'), ('tn_BW', 'Tswana'), ('ss_SZ', 'Swati'), ('ts_ZA', 'Tsonga'), ('ve_ZA', 'Venda'), ('nr_ZA', 'Ndebele'), ('wo_SN', 'Wolof'), ('ff_SN', 'Fula'), ('ln_CD', 'Lingala')]
LANGUAGES.sort(key=lambda x: x[1])

def normalize_lang_code(code):
    if '_' in code:
        parts = code.split('_')
        if parts[0] == 'zh':
            return 'zh-CN'
        return parts[0]
    return code

def generate_xml():
    print(f'============================================================')
    print(f'  SUPREME TRANSLATOR ENGINE - INICIANDO GERA√á√ÉO DE XML')
    print(f'============================================================')
    root = ET.Element('languages')
    total_langs = len(LANGUAGES)
    start_time = time.time()
    for i, (code, name) in enumerate(LANGUAGES):
        print(f'[{i + 1}/{total_langs}] Processando: {name} ({code})... ', end='', flush=True)
        lang_elem = ET.SubElement(root, 'language')
        lang_elem.set('code', code)
        lang_elem.set('name', name)
        if code == 'pt_BR':
            for k, v in PT_STRINGS.items():
                s = ET.SubElement(lang_elem, 'string')
                s.set('key', k)
                s.text = v
            print('OK (Nativo)')
        elif code == 'en_US':
            for k, v in EN_STRINGS.items():
                s = ET.SubElement(lang_elem, 'string')
                s.set('key', k)
                s.text = v
            print('OK (Nativo)')
        else:
            target_lang = normalize_lang_code(code)
            try:
                translator = GoogleTranslator(source='en', target=target_lang)
                count = 0
                for k, v_en in EN_STRINGS.items():
                    s = ET.SubElement(lang_elem, 'string')
                    s.set('key', k)
                    if not v_en.strip():
                        s.text = v_en
                        continue
                    try:
                        translated_text = translator.translate(v_en)
                        s.text = translated_text
                    except Exception as e:
                        s.text = v_en
                    count += 1
                print(f'OK (Traduzido via API)')
                time.sleep(0.5)
            except Exception as e:
                print(f'FALHA ({e}) - Usando Fallback EN')
                for k, v in EN_STRINGS.items():
                    s = ET.SubElement(lang_elem, 'string')
                    s.set('key', k)
                    s.text = v
    xml_str = xml.dom.minidom.parseString(ET.tostring(root)).toprettyxml(indent='    ')
    filename = 'languages.xml'
    with open(filename, 'w', encoding='utf-8') as f:
        f.write(xml_str)
    elapsed = time.time() - start_time
    print(f'\n============================================================')
    print(f'  SUCESSO ABSOLUTO.')
    print(f'  Arquivo gerado: {filename}')
    print(f'  Tempo decorrido: {elapsed:.2f} segundos')
    print(f'============================================================')
if __name__ == '__main__':
    generate_xml()